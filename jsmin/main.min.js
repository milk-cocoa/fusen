$(function(){function e(e,t,n,i,o){var c=i||"",u=a.createFusen(e,c,o);u.setPos(t,n)}var t=navigator.userAgent,n=milkcocoa.dataStore("fusen"),i="one",o=$("#canvas"),a=new FusenBuilder(o,n),c="pc";c=t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("iPod")>0||t.indexOf("Android")>0?"mobile":"pc",$(".p-colorlist__item").click(function(e){i=$(this).attr("id"),$(".p-colorlist__item").each(function(){$(this).removeClass("is-active")}),$(this).addClass("is-active"),e.stopPropagation()}),n.stream().size(20).sort("desc").next(function(t,n){for(var i=0;i<n.length;i++)e(n[i].id,n[i].value.x,n[i].value.y,n[i].value.text,n[i].value.color)}),n.on("push",function(t){e(t.id,t.value.x,t.value.y,t.value.text,t.value.color)}),n.on("set",function(e){a.getFusen(e.id).setPos(e.value.x,e.value.y)}),n.on("remove",function(e){var t=e;a.getFusen(t.id).removeSelf()}),o.click(function(e){var t=prompt("メモを入力してください。"),o=i;t&&n.push({x:e.pageX,y:e.pageY,text:fusen_util.htmlEscape(t),color:o})}),window.fusen_util={getDevice:function(){return c},htmlEscape:function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/</g,"&lt;")}}});