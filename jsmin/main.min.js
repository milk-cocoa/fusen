$(function(){function e(e){var n=new Date,t=new Date(n.getTime()-25056e5),o=i.history(),a=[];o.sort("desc").size(100).span(t.getTime(),n.getTime()),o.on("data",function(e){a=a.concat(e).filter(function(e){return!e.value.deleted})}),o.on("end",function(){e(a)}),o.on("error",function(e){console.log(e)}),o.run()}function n(e,n,t,i,o){var a=i||"",c=u.createFusen(e,a,o);c.setPos(n,t)}var t=navigator.userAgent,i=milkcocoa.dataStore("fusen"),o="one",a=$("#canvas"),u=new FusenBuilder(a,i),c=100,l=function(){},r=function(){},s="pc";s=t.indexOf("iPhone")>0||t.indexOf("iPad")>0||t.indexOf("iPod")>0||t.indexOf("Android")>0?"mobile":"pc",$(".p-colorlist__item").click(function(e){o=$(this).attr("id"),$(".p-colorlist__item").each(function(){$(this).removeClass("is-active")}),$(this).addClass("is-active"),e.stopPropagation()}),e(function(e){for(var t=e.length>c?c:e.length,i=0;t>i;i++)n(e[i].id,e[i].value.x,e[i].value.y,e[i].value.text,e[i].value.color)}),r=function(e){u.getFusen(e.id).removeSelf()},l=function(e){u.getFusen(e.id).setPos(e.value.x,e.value.y)},i.on("push",function(e){n(e.id,e.value.x,e.value.y,e.value.text,e.value.color)}),i.on("set",function(e){e.value.deleted?r(e):l(e)}),a.click(function(e){var n=prompt("メモを入力してください。"),t=o;n&&i.push({x:e.pageX,y:e.pageY,text:fusen_util.htmlEscape(n),color:t})}),window.fusen_util={getDevice:function(){return s},htmlEscape:function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/</g,"&lt;")}}});